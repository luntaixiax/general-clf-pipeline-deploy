WITH
	toDate32('{snap_dt}') AS SPDT
SELECT
	CUST_ID,
    '{snap_dt}' AS SNAP_DT,
	COUNT(PUR_TS) AS NUM_PUR_F7D,
	SUM(PUR_NUM) AS TOTAL_PUR_NUM_F7D,
	SUM(PUR_AMT) AS TOTAL_PUR_AMT_F7D
FROM
	RAW.PURCHASES
WHERE
	PUR_TS BETWEEN date_add(DAY, 1, SPDT) AND date_add(DAY, 8, SPDT)
GROUP BY
	CUST_ID